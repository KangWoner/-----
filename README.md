# AI 기반 Google Form 자동 채점 및 피드백 스크립트 (V2)

Google Form으로 제출된 과제를 OpenAI Vision API를 이용해 자동으로 채점하고, 그 결과를 Google Sheets에 기록한 뒤 학생에게 이메일로 피드백을 보내주는 Google Apps Script 프로토타입입니다.

## 주요 기능 (V2)

- **문제 선택 기능**: 지정된 Google Sheet에서 문제 목록을 자동으로 가져와 Form에 드롭다운 메뉴로 표시합니다.
- **이미지 풀이 분석**: 학생이 '파일 업로드'로 제출한 손글씨 풀이 사진을 AI Vision 모델이 직접 분석하고 채점합니다.
- **자동 채점 및 피드백**: Form 응답이 제출되면, AI가 문제, 학생의 풀이(이미지), 참고 URL을 종합하여 채점합니다.
- **결과 기록 및 이메일 알림**: 채점 결과(총점, 항목별 점수, 피드백)를 시트에 기록하고 학생에게 이메일로 발송합니다.
- **쉬운 설정**: Google Sheet에 추가되는 커스텀 메뉴를 통해 클릭 한 번으로 문제 목록을 업데이트할 수 있습니다.

---

## 사전 준비 사항

1.  **Google 계정**: Google Forms, Google Sheets, Gmail, Google Drive 사용을 위해 필요합니다.
2.  **OpenAI API 키**: OpenAI 또는 호환 API 제공업체로부터 발급받은 API 키가 필요합니다. **(GPT-4-turbo와 같은 Vision 모델 접근 권한이 필요합니다.)**
    - [OpenAI API 키 발급 페이지](https://platform.openai.com/api-keys)
3.  **문제 목록 시트**: 문제 이름이 정리된 Google Sheet가 필요합니다. (본 프로젝트에서는 [이 시트](https://docs.google.com/spreadsheets/d/1pUUG_zX96zOMA96EaDH20RkPYEa5LLePIGbuC8Wy3hg/edit?usp=sharing)를 기본값으로 사용합니다.)

---

## 설치 및 설정 방법

### 1단계: Google Form 및 Sheet 생성

1.  **Google Form 생성**:
    - [Google Forms](https://forms.google.com/u/0/)로 이동하여 새 양식을 만듭니다.
    - 아래 설명에 따라 질문을 추가하고 **질문 유형**을 정확히 설정합니다.
      - `이름` (단답형)
      - `이메일` (단답형, 이메일 주소 형식 확인 권장)
      - `내가 푼 문제` (**드롭다운**)
      - `나의 풀이` (**파일 업로드**)
        - "특정 파일 형식만 허용"을 **ON**으로 바꾸고 **이미지**를 선택하는 것을 권장합니다.
        - Google Drive에 응답 파일이 저장될 폴더가 자동으로 생성됩니다.
      - `논술문제 해설(URL)` (단답형, 선택 사항)

2.  **Google Sheet 연결**:
    - Form 편집기 상단의 **'응답'** 탭으로 이동하여 응답 시트를 생성합니다.
    - 생성된 시트가 새 탭에서 열립니다. 스크립트가 자동으로 `총점`, `항목별 점수`, `피드백` 열을 찾아 기록하므로, 미리 헤더를 추가해두지 않아도 됩니다.

### 2단계: Apps Script 코드 붙여넣기

1.  **Apps Script 편집기 열기**:
    - 응답을 받고 있는 Google Sheet에서 상단 메뉴의 **'확장 프로그램' > 'Apps Script'**를 클릭합니다.

2.  **코드 붙여넣기**:
    - `Code.gs`와 `appsscript.json` 파일의 내용을 이 프로젝트의 최신 코드로 각각 복사하여 붙여넣습니다. (기존 내용은 모두 삭제)
    - **파일 > 프로젝트 저장 (디스크 아이콘)**을 눌러 저장합니다.

### 3단계: OpenAI API 키 등록

- Apps Script 편집기 왼쪽 메뉴의 **'프로젝트 설정' (톱니바퀴 아이콘)**으로 이동합니다.
- **'스크립트 속성'** 섹션에서 `OPENAI_API_KEY`라는 이름으로 본인의 API 키를 추가하고 저장합니다.

### 4단계: 트리거 설정

- Apps Script 편집기 왼쪽 메뉴의 **'트리거' (시계 아이콘)**를 클릭합니다.
- **'+ 트리거 추가'** 버튼을 누르고 아래와 같이 `onFormSubmit` 함수에 대한 트리거를 설정합니다.
  - **실행할 함수**: `onFormSubmit`
  - **이벤트 소스**: `스프레드시트에서`
  - **이벤트 유형**: `양식 제출 시`
- **'저장'** 버튼을 누르고 필요한 권한을 모두 승인합니다. (Drive, Forms 접근 권한이 추가로 필요합니다.)

### 5단계: 문제 목록 업데이트 (최초 1회 실행)

1.  **Google Sheet 새로고침**: 모든 설정이 끝났으면, 응답 시트 브라우저 탭을 새로고침합니다.
2.  **커스텀 메뉴 실행**:
    - 시트 상단 메뉴에 **'AI 채점 도우미'**라는 새로운 메뉴가 나타납니다.
    - **'AI 채점 도우미' > '문제 목록 업데이트'**를 클릭합니다.
3.  **권한 승인 및 실행**:
    - 처음 실행 시 스크립트 권한을 다시 한번 요구할 수 있습니다. 모든 권한을 허용해주세요.
    - 잠시 후 "성공적으로 N개의 문제를 드롭다운에 추가했습니다."라는 팝업이 뜨면 완료된 것입니다.
    - 이제 Google Form의 '내가 푼 문제' 드롭다운에 문제 목록이 채워졌는지 확인합니다.

---

## 테스트 절차

1.  **양식 제출**:
    - Google Form을 열어 테스트용 데이터를 입력하고 제출합니다.
    - '내가 푼 문제'는 드롭다운에서 선택하고, '나의 풀이'에는 **풀이 과정이 담긴 이미지 파일을 업로드**합니다.
2.  **결과 확인**:
    - **Google Sheet**: 잠시 후(이미지 분석으로 인해 30초~1분 정도 소요될 수 있음) 시트에 **총점, 항목별 점수, 피드백**이 채워지는지 확인합니다.
    - **이메일**: 양식에 입력한 이메일로 피드백 요약이 도착했는지 확인합니다.
3.  **실행 로그 확인 (오류 발생 시)**:
    - 결과가 나타나지 않으면 Apps Script 편집기의 **'실행'** 탭에서 오류 기록을 확인합니다.
